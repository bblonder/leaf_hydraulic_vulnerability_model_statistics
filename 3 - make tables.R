library(dplyr)
library(psych)

source('variable names.R')

data_no_outliers = readRDS('outputs/data_flagged.Rdata') %>% 
  filter(is_outlier == FALSE)

# don't do sqrt xvars
xvars_this = xvars
xvars_this = gsub("sqrt_","",xvars_this)
xvars_this = gsub("Log10_","",xvars_this)

xvars_nice = xvars_nice %>% 
  c(vein_density_1 = "Macro - VD1", 
    vein_density_5 = "Macro - VD5", 
    vein_loop_density_1 = "Macro - LD1", 
    vein_loop_density_5 = "Macro - LD5",
    Pit_size_nm="Micro - Dpore")

table_x = data_no_outliers %>% 
  select(all_of(xvars_this)) %>% 
  mutate_at(vars(contains('vein_density')), ~ (. / 1000)) %>%
  mutate_at(vars(contains('vein_loop_density')), ~ (. / 1000^2)) %>%
  na.omit %>%
  describe %>%
  select(-n, -vars,-trimmed, -mad, -range, -kurtosis, -range, -se) %>%
  as.data.frame
table_x = table_x %>%
  mutate(var=xvars_nice[row.names(table_x)]) %>%
  select(var,everything())

write.csv(table_x, file='outputs/table_x.csv',row.names=FALSE,fileEncoding = "UTF-8")


table_y = data_no_outliers %>% 
  select(all_of(yvars)) %>% 
  mutate_at(vars(contains('kleaf')), ~ (. / 18 / 10^-5)) %>% # convert from m-3 m-2 s-1
  na.omit %>%
  describe %>%
  select(-n, -vars,-trimmed, -mad, -range, -kurtosis, -range, -se) %>%
  as.data.frame
table_y = table_y %>%
  mutate(var=yvars_nice[row.names(table_y)]) %>%
  select(var,everything())

write.csv(table_y, file='outputs/table_y.csv',row.names=FALSE,fileEncoding = "UTF-8")

